<?php
/**
 * @file
 * Code for the dt Publication feature.
 */

include_once 'dt_publication.features.inc';

/**
 * Implements hook_migrate_api().
 */
function dt_publication_migrate_api() {
  return array(
    'api' => 2,
    'groups' => array(
      'NextEuropa' => array(
        'title' => t('Stage initial content, publication types.'),
      ),
    ),
    'migrations' => array(
      'DTPublicationPublicationTypes' => array(
        'class_name' => 'DTPublicationPublicationTypesMigration',
        'group_name' => 'NextEuropa Digital Transformation',
      ),
    ),
  );
}

/**
 * Implements hook_field_display_alter().
 */
function dt_publication_field_display_alter(&$display, $context) {
  $node_wrapper = entity_metadata_wrapper($context['entity_type'], $context['entity']);
  if (isset($node_wrapper->field_publication_collection)) {
    $type = $node_wrapper->field_publication_collection->value();
    switch ($type) {
      // Publication.
      case '0':
        if ($context['field']['field_name'] == 'field_core_publications') {
          $display['type'] = 'hidden';
        }
        break;

      // Collection.
      case '1':
        if ($context['field']['field_name'] == 'field_core_files') {
          $display['type'] = 'hidden';
        }
        break;
    }
  }
}

/**
 * Implements hook_ds_fields_info().
 */
function dt_publication_ds_fields_info($entity_type) {
  $fields = array();

  $fields['collection_documents'] = array(
    'title' => t('Collection documents'),
    'field_type' => DS_FIELD_TYPE_BLOCK,
    'block' => 'publications-block',
    'block_render' => DS_BLOCK_CONTENT,
    'ui_limit' => array('publication|*'),
  );

  return array('node' => $fields);
}

function _dt_publication_collection_documents() {

}

/**
 * Implements hook_node_view_alter().
 */
function dt_publication_node_view_alter(&$build) {
  $temp = "stop";
}

function dt_publication_node_view($node, $view_mode, $langcode) {
  $temp = "stop";
}

function dt_publication_ds_pre_render_alter(&$layout_render_array, $context) {
  if ($context['entity_type'] == 'node' && $context['bundle'] == 'publication' && $context['view_mode'] == 'full') {
    $node_wrapper = entity_metadata_wrapper($context['entity_type'], $context['entity']);
    $type = $node_wrapper->field_publication_collection->value();
    switch ($type) {
      // Publication.
      case '0':

        break;

      // Collection.
      case '1':
        $temp = "stop";
//        unset($layout_render_array['top'][9]['field_core_publications']);
        break;
    }
  }
}

/**
 * Implements hook_node_load().
 */
function dt_publication_node_load($nodes, $types) {
  $temp = "stop";
}
