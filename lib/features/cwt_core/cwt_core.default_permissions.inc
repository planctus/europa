<?php

/**
 * @file
 * Default user permissions for the Commissioners' Web Template project.
 */

/**
 * Resets user permissions to the default state.
 *
 * For this project we are not using Features to export the user permissions
 * since this has a number of drawbacks:
 * - It creates highly interdependent features.
 * - Reverting features containing permissions sometimes causes problems, for
 *   example when a permission is being set for a component that has not been
 *   reverted yet.
 * - Features containing permissions become overridden when the permissions are
 *   changed by the site administrator.
 *
 * This function will set the permissions to the default state. Note that this
 * only covers a curated set of permissions and user roles, any permissions or
 * user roles that are not covered will not be affected and should be verified
 * manually.
 *
 * @see cwt_core_get_default_permissions()
 * @see cwt_core_get_default_vocabulary_permissions()
 */
function cwt_core_reset_default_permissions() {
  $permissions_by_role = drupal_array_merge_deep(cwt_core_get_default_permissions(), cwt_core_get_default_vocabulary_permissions());
  $roles = array_flip(user_roles());

  // Compile a list of all the permissions that we cover.
  $permissions_list = array_unique(call_user_func_array('array_merge', $permissions_by_role));

  foreach ($permissions_by_role as $role => $permissions) {
    // Grant default permissions for this role.
    user_role_grant_permissions($roles[$role], $permissions);

    // Revoke default permissions for this role.
    user_role_revoke_permissions($roles[$role], array_diff($permissions_list, $permissions));
  }
}

/**
 * Returns a set of default permissions regarding vocabularies.
 *
 * @return array
 *   An associative array, keyed by role machine name, containing an array of
 *   default permissions that are applicable to the role.
 */
function cwt_core_get_default_vocabulary_permissions() {
  $vocabularies = array(
    'administrator' => array(
      'aggregated_item_types',
      'classification',
      'departments',
      'editorial_sections',
      'portfolio_subjects',
      'tags',
    ),

    'editor' => array(
      'aggregated_item_types',
      'biography_timeline_types',
      'biography_roles',
      'departments',
      'editorial_sections',
      'portfolio_subjects',
      'project_teams',
      'tags',
      'team_statuses',
      'team_subtypes',
      'team_terms',
    ),

    'section editor' => array(
      'tags',
    ),

    'agenda validator' => array(
      'tags',
    ),

    'site manager' => array(
      'aggregated_item_types',
      'biography_timeline_types',
      'biography_roles',
      'departments',
      'editorial_sections',
      'portfolio_subjects',
      'project_teams',
      'tags',
      'team_statuses',
      'team_subtypes',
      'team_terms',
    ),
  );

  $vocabulary_names = taxonomy_vocabulary_get_names();

  $permissions = array();
  foreach ($vocabularies as $role => $machine_names) {
    foreach ($machine_names as $machine_name) {
      $permissions[$role][] = "delete terms in {$vocabulary_names[$machine_name]->vid}";
      $permissions[$role][] = "edit terms in {$vocabulary_names[$machine_name]->vid}";
    }
  }

  return $permissions;
}

/**
 * Returns a set of default permissions.
 *
 * @return array
 *   An associative array, keyed by role machine name, containing an array of
 *   default permissions that are applicable to the role.
 */
function cwt_core_get_default_permissions() {
  return array(
    'administrator' => array(
      'access administration menu',
      'access administration pages',
      'access ckeditor link',
      'access content',
      'access content overview',
      'access site in maintenance mode',
      'access site reports',
      'access workbench access by role',
      'administer blocks',
      'administer comments',
      'administer content translations',
      'administer files',
      'administer menu',
      'administer nodes',
      'administer site configuration',
      'administer social_network_links',
      'administer taxonomy',
      'administer translation tasks',
      'administer users',
      'administer workbench',
      'administer workbench access',
      'administer workbench moderation',
      'assign node weight',
      'assign workbench access',
      'batch update workbench access',
      'bypass file access',
      'bypass node access',
      'bypass workbench moderation',
      'create aggregated_news content',
      'create custom_page content',
      'create highlight content',
      'create page content',
      'create team content',
      'create team_priority content',
      'create url aliases',
      'delete any aggregated_news content',
      'delete any audio files',
      'delete any custom_page content',
      'delete any document files',
      'delete any highlight content',
      'delete any image files',
      'delete any page content',
      'delete any team content',
      'delete any team_priority content',
      'delete any video files',
      'delete own aggregated_news content',
      'delete own audio files',
      'delete own custom_page content',
      'delete own document files',
      'delete own highlight content',
      'delete own page content',
      'delete own team content',
      'delete own team_priority content',
      'delete own video files',
      'delete revisions',
      'display drupal links',
      'download any audio files',
      'download any document files',
      'download any image files',
      'download any video files',
      'download own audio files',
      'download own document files',
      'download own image files',
      'download own video files',
      'edit any aggregated_news content',
      'edit any audio files',
      'edit any custom_page content',
      'edit any document files',
      'edit any highlight content',
      'edit any image files',
      'edit any page content',
      'edit any team content',
      'edit any team_priority content',
      'edit any video files',
      'edit links on aggregated news items',
      'edit own aggregated_news content',
      'edit own audio files',
      'edit own comments',
      'edit own custom_page content',
      'edit own document files',
      'edit own highlight content',
      'edit own page content',
      'edit own team content',
      'edit own team_priority content',
      'edit own video files',
      'flush caches',
      'manipulate all queues',
      'manipulate queues',
      'multisite_workbench_moderation_view_bulk_update',
      'provide translation services',
      'skip comment approval',
      'translate admin strings',
      'translate any entity',
      'translate interface',
      'translate taxonomy_term entities',
      'translate user-defined strings',
      'use text format news_text_filter',
      'use text format custom_text_filter',
      'use text format full_access_text_filter',
      'view advanced help index',
      'view advanced help popup',
      'view advanced help topic',
      'view private files',
      'view the administration theme',
      'view translation overview assigments',
      'view workbench access information',
      'view workbench taxonomy pages',
    ),

    'editor' => array(
      'access administration menu',
      'access administration pages',
      'access ckeditor link',
      'access content overview',
      'access site reports',
      'access workbench access by role',
      'administer comments',
      'administer content translations',
      'administer files',
      'administer menu',
      'administer nodes',
      'administer social_network_links',
      'administer taxonomy',
      'administer translation tasks',
      'assign node weight',
      'assign workbench access',
      'batch update workbench access',
      'bypass node access',
      'bypass workbench moderation',
      'clear news feeds',
      'create activities content',
      'create aggregated_news content',
      'create biography_assistant content',
      'create commisioner_blog_post content',
      'create highlight content',
      'create news_importer content',
      'create team content',
      'create team_priority content',
      'create url aliases',
      'delete any activities content',
      'delete any aggregated_news content',
      'delete any audio files',
      'delete any biography_assistant content',
      'delete any commisioner_blog_post content',
      'delete any document files',
      'delete any highlight content',
      'delete any image files',
      'delete any news_importer content',
      'delete any team content',
      'delete any team_priority content',
      'delete any video files',
      'delete own activities content',
      'delete own aggregated_news content',
      'delete own audio files',
      'delete own biography_assistant content',
      'delete own commisioner_blog_post content',
      'delete own document files',
      'delete own highlight content',
      'delete own news_importer content',
      'delete own team content',
      'delete own team_priority content',
      'delete own video files',
      'delete revisions',
      'download any audio files',
      'download any document files',
      'download any image files',
      'download own audio files',
      'edit any activities content',
      'edit any aggregated_news content',
      'edit any audio files',
      'edit any biography_assistant content',
      'edit any commisioner_blog_post content',
      'edit any document files',
      'edit any highlight content',
      'edit any image files',
      'edit any news_importer content',
      'edit any team content',
      'edit any team_priority content',
      'edit any video files',
      'edit own activities content',
      'edit own aggregated_news content',
      'edit own audio files',
      'edit own biography_assistant content',
      'edit own commisioner_blog_post content',
      'edit own document files',
      'edit own highlight content',
      'edit own news_importer content',
      'edit own team content',
      'edit own team_priority content',
      'edit own video files',
      'import news feeds',
      'manipulate all queues',
      'manipulate queues',
      'multisite_workbench_moderation_view_bulk_update',
      'provide translation services',
      'translate admin strings',
      'translate any entity',
      'translate interface',
      'translate taxonomy_term entities',
      'translate user-defined strings',
      'unlock news feeds',
      'use text format news_text_filter',
      'use text format custom_text_filter',
      'view advanced help index',
      'view advanced help popup',
      'view advanced help topic',
      'view private files',
      'view the administration theme',
      'view translation overview assigments',
      'view workbench access information',
      'view workbench taxonomy pages',
    ),

    'section editor' => array(
      'access administration menu',
      'access administration pages',
      'access ckeditor link',
      'access media browser',
      'access partially translated biographies',
      'access workbench',
      'access workbench access by role',
      'administer nodes',
      'batch update workbench access',
      'create activities content',
      'create aggregated_news content',
      'create files',
      'delete any activities content',
      'delete any aggregated_news content',
      'delete own activities content',
      'delete own aggregated_news content',
      'delete own audio files',
      'delete own document files',
      'delete own image files',
      'delete own video files',
      'delete terms in 2',
      'download any audio files',
      'download any document files',
      'download any image files',
      'download own audio files',
      'edit any activities content',
      'edit any aggregated_news content',
      'edit own activities content',
      'edit own aggregated_news content',
      'edit own audio files',
      'edit own comments',
      'edit own document files',
      'edit own image files',
      'edit own video files',
      'moderate content from draft to needs_review',
      'moderate content from needs_review to draft',
      'moderate content from needs_review to published',
      'moderate content from needs_review to published',
      'moderate content from needs_review to validated',
      'moderate content from validated to published',
      'multisite_workbench_moderation_view_bulk_update',
      'use media wysiwyg',
      'use text format custom_text_filter',
      'use text format news_text_filter',
      'use workbench_moderation my drafts tab',
      'use workbench_moderation needs review tab',
      'view advanced help index',
      'view advanced help popup',
      'view advanced help topic',
      'view all unpublished content',
      'view own files',
      'view own private files',
      'view private files',
      'view the administration theme',
      'view workbench access information',
    ),

    'agenda validator' => array(
      'access administration menu',
      'access administration pages',
      'access ckeditor link',
      'access media browser',
      'access partially translated biographies',
      'access workbench access by role',
      'access workbench',
      'administer nodes',
      'batch update workbench access',
      'create activities content',
      'create aggregated_news content',
      'create files',
      'delete any activities content',
      'delete any aggregated_news content',
      'delete own activities content',
      'delete own aggregated_news content',
      'delete own audio files',
      'delete own document files',
      'delete own image files',
      'delete own video files',
      'delete terms in 2',
      'download any audio files',
      'download any document files',
      'download any image files',
      'download own audio files',
      'edit any activities content',
      'edit any aggregated_news content',
      'edit own activities content',
      'edit own aggregated_news content',
      'edit own audio files',
      'edit own comments',
      'edit own document files',
      'edit own image files',
      'edit own video files',
      'edit terms in 2',
      'moderate content from draft to needs_review',
      'moderate content from needs_review to draft',
      'moderate content from needs_review to published',
      'moderate content from needs_review to published',
      'moderate content from needs_review to published',
      'moderate content from needs_review to published',
      'moderate content from needs_review to validated',
      'moderate content from needs_review to validated',
      'moderate content from validated to published',
      'moderate content from validated to published',
      'multisite_workbench_moderation_view_bulk_update',
      'multisite_workbench_moderation_view_bulk_update',
      'use media wysiwyg',
      'use text format custom_text_filter',
      'use text format news_text_filter',
      'use workbench_moderation my drafts tab',
      'use workbench_moderation needs review tab',
      'view advanced help index',
      'view advanced help popup',
      'view advanced help topic',
      'view all unpublished content',
      'view own files',
      'view own private files',
      'view private files',
      'view the administration theme',
      'view workbench access information',
    ),

    'site manager' => array(
      'access administration menu',
      'access administration pages',
      'access ckeditor link',
      'access content overview',
      'access site in maintenance mode',
      'access site reports',
      'access workbench access by role',
      'administer comments',
      'administer content translations',
      'administer files',
      'administer menu',
      'administer nodes',
      'administer site configuration',
      'administer social_network_links',
      'administer taxonomy',
      'administer translation tasks',
      'administer users',
      'administer workbench',
      'administer workbench access',
      'assign node weight',
      'assign workbench access',
      'batch update workbench access',
      'bypass node access',
      'bypass workbench moderation',
      'clear news feeds',
      'create activities content',
      'create aggregated_news content',
      'create biography_assistant content',
      'create commisioner_blog_post content',
      'create custom_page content',
      'create highlight content',
      'create news_importer content',
      'create team content',
      'create team_priority content',
      'create url aliases',
      'delete any activities content',
      'delete any aggregated_news content',
      'delete any audio files',
      'delete any biography_assistant content',
      'delete any commisioner_blog_post content',
      'delete any custom_page content',
      'delete any document files',
      'delete any highlight content',
      'delete any image files',
      'delete any news_importer content',
      'delete any team content',
      'delete any team_priority content',
      'delete any video files',
      'delete own activities content',
      'delete own aggregated_news content',
      'delete own audio files',
      'delete own biography_assistant content',
      'delete own commisioner_blog_post content',
      'delete own custom_page content',
      'delete own document files',
      'delete own highlight content',
      'delete own news_importer content',
      'delete own team content',
      'delete own team_priority content',
      'delete own video files',
      'delete revisions',
      'download any audio files',
      'download any document files',
      'download any image files',
      'download own audio files',
      'edit any activities content',
      'edit any aggregated_news content',
      'edit any audio files',
      'edit any biography_assistant content',
      'edit any commisioner_blog_post content',
      'edit any custom_page content',
      'edit any document files',
      'edit any highlight content',
      'edit any image files',
      'edit any news_importer content',
      'edit any team content',
      'edit any team_priority content',
      'edit any video files',
      'edit own activities content',
      'edit own aggregated_news content',
      'edit own audio files',
      'edit own biography_assistant content',
      'edit own commisioner_blog_post content',
      'edit own custom_page content',
      'edit own document files',
      'edit own highlight content',
      'edit own news_importer content',
      'edit own team content',
      'edit own team_priority content',
      'edit own video files',
      'import news feeds',
      'manipulate all queues',
      'manipulate queues',
      'multisite_workbench_moderation_view_bulk_update',
      'provide translation services',
      'translate admin strings',
      'translate any entity',
      'translate interface',
      'translate taxonomy_term entities',
      'translate user-defined strings',
      'unlock news feeds',
      'use text format news_text_filter',
      'use text format custom_text_filter',
      'use text format full_access_text_filter',
      'view advanced help index',
      'view advanced help popup',
      'view advanced help topic',
      'view all unpublished content',
      'view private files',
      'view the administration theme',
      'view translation overview assigments',
      'view workbench access information',
      'view workbench taxonomy pages',
    ),

    'contributor' => array(
      'access ckeditor link',
      'download any document files',
      'download any image files',
      'use text format news_text_filter',
      'use text format custom_text_filter',
    ),

    'anonymous user' => array(
      'access content',
      'download any audio files',
      'download any document files',
      'download any image files',
      'download any video files',
      'download own audio files',
      'download own document files',
      'download own image files',
      'download own video files',
    ),

    'authenticated user' => array(
      'access content',
      'download any document files',
      'download any image files',
      'download any video files',
      'download own document files',
      'download own image files',
      'download own video files',
      'edit own comments',
      'skip comment approval',
    ),

    'blog editor' => array(
      'administer comments',
      'delete own commisioner_blog_post content',
      'view all unpublished content',
      'view own files',
      'view own private files',
      'Access to unpublished file',
      'access administration menu',
      'access administration pages',
      'access ckeditor link',
      'access workbench access by role',
      'edit own comments',
      'administer nodes',
      'batch update workbench access',
      'create files',
      'delete any commisioner_blog_post content',
      'delete own audio files',
      'delete own document files',
      'delete own image files',
      'delete own video files',
      'download any audio files',
      'download any document files',
      'download any image files',
      'download own audio files',
      'edit any commisioner_blog_post content',
      'edit own audio files',
      'edit own commisioner_blog_post content',
      'edit own document files',
      'edit own image files',
      'edit own video files',
      'use text format news_text_filter',
      'use text format custom_text_filter',
      'view advanced help index',
      'view advanced help popup',
      'view advanced help topic',
      'view all unpublished content',
      'view own files',
      'view own private files',
      'view private files',
      'view the administration theme',
      'view workbench access information',
    ),
  );
}
