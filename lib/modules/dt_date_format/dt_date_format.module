<?php
/**
 * @file
 * EC date format definition.
 *
 * @see http://thinkshout.com/blog/2014/05/custom-date-formats-in-drupal/
 */

/**
 * Implements hook_date_format_types().
 */
function dt_date_format_date_format_types() {
  return [
    'ec_date_j_f_y' => t('EC date format (j F Y)'),
    'ec_date_l_j_f' => t('EC date format (l j F)'),
  ];
}

/**
 * Implements hook_date_formats().
 */
function dt_date_format_date_formats() {
  $formats = [];

  $formats[] = [
    'type' => 'ec_date_j_f_y',
    'format' => 'j F Y',
    'locales' => [],
  ];

  $formats[] = [
    'type' => 'ec_date_l_j_f',
    'format' => 'l j F',
    'locales' => [],
  ];
  foreach ($formats as $format) {
    variable_set('date_format_' . $format['type'], $format['format']);
  }
  return [$formats];
}

/**
 * Returns HTML for a date element formatted as a range.
 */
function dt_date_format_date_display_range($variables) {
  $date1 = $variables['date1'];
  $date2 = $variables['date2'];
  $timezone = $variables['timezone'];
  $attributes_start = $variables['attributes_start'];
  $attributes_end = $variables['attributes_end'];
  $show_remaining_days = $variables['show_remaining_days'];

  $start_date = '<span class="date-display-start"' . drupal_attributes($attributes_start) . '>' . $date1 . '</span>';
  $end_date = '<span class="date-display-end"' . drupal_attributes($attributes_end) . '>' . $date2 . $timezone . '</span>';

  // If microdata attributes for the start date property have been passed in,
  // add the microdata in meta tags.
  if (!empty($variables['add_microdata'])) {
    $start_date .= '<meta' . drupal_attributes($variables['microdata']['value']['#attributes']) . '/>';
    $end_date .= '<meta' . drupal_attributes($variables['microdata']['value2']['#attributes']) . '/>';
  }

  // Wrap the result with the attributes.
  $output = '<div class="date-display-range">' . t('!start-date to !end-date', [
    '!start-date' => $start_date,
    '!end-date' => $end_date,
    ]) . '</div>';

  // Add remaining message and return.
  return $output . $show_remaining_days;
}
