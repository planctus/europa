<?php

/**
 * @file
 * Contains the overrides and hooks to enable a custom title on entityreference.
 */

/**
 * Implements hook_field_widget_WIDGET_TYPE_form_alter().
 */
function entityreference_titleoverwrite_field_widget_entityreference_autocomplete_form_alter(&$element, &$form_state, $context) {

  if (isset($element['target_id'])) {
    // Add the title element.
    $element['entityrefence_title_override'] = array(
      '#weight' => 1,
      '#title' => t('Title override'),
      '#description' => t('This gives you the oppertunity to override the title displayed'),
      '#type' => 'textfield',
      '#maxlength' => 150,
      '#default_value' => '',
      '#size' => 60,
      '#element_validate' => array('_entityreference_title_override_validate'),
    );

    // Change the weight of target_id.
    $element['target_id']['#weight'] = 2;
  }

  $test = TRUE;

}