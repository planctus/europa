<?php

/*
* hook_enable
*/
function wiki_og_enable() {
  // add elements to contexts
  multisite_drupal_toolbox_add_views_context("communities", "wiki_list");
  //  multisite_drupal_toolbox_add_block_context('communities', 'wiki_list-block_1', 'views', 'wiki_list-block_1', 'sidebar_first');
  multisite_drupal_toolbox_add_content_type_context('communities', 'wiki');
  
  multisite_drupal_toolbox_add_views_context("communities_menu_item", "wiki_list:page_1");
  multisite_drupal_toolbox_add_path_context('communities_menu_item', 'community/*/wiki/*');
  
  // add wiki content type to newsletters related contents
  multisite_drupal_toolbox_add_content_type_newsletters('wiki');
  
  // override drupal variables defined in core feature
  variable_set('pathauto_node_wiki_pattern', 'community/[node:og_group_ref]/wiki/[node:title]');
  
  drupal_flush_all_caches();
}




/*
 * Hook disable 
 */
function wiki_og_disable() {
  // Remove block
  multisite_drupal_toolbox_remove_views_context("communities", "wiki_list");
  //multisite_drupal_toolbox_remove_block_context('communities', 'wiki_list-block_1');
  multisite_drupal_toolbox_remove_content_type_context('communities', 'wiki');

  multisite_drupal_toolbox_remove_views_context("communities_menu_item", "wiki_list:page_1");
  multisite_drupal_toolbox_remove_path_context('communities_menu_item', 'community/*/wiki/*');
  
  /*** Remove permissions ***/
  multisite_drupal_toolbox_disable_content_type('wiki');
       
  // delete drupal variables
  variable_del('pathauto_node_wiki_pattern');
}


/**
 * hook_modules_enabled
 */
function wiki_og_modules_enabled($modules) {
  if (in_array('wiki_og', $modules)) {
    // force feature revert to update og permissions
    features_revert(array('wiki_og' => array('og_features_permission')));  
  }
}

/**
* Add wiki options on "communities_menu_item" context
*/
function wiki_og_update_7102 (){
  multisite_drupal_toolbox_add_views_context("communities_menu_item", "wiki_list:page_1");
  multisite_drupal_toolbox_add_path_context('communities_menu_item', 'community/*/wiki/*');
}
