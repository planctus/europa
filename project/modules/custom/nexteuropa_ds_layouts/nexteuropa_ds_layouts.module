<?php
/**
 * @file
 * Nexteuropa display suite settings and helpers.
 */

/**
 * Define Display Suite layouts.
 *
 * @return array
 *   A collection of layouts.
 */
function nexteuropa_ds_layouts_ds_layout_info() {
  $path = drupal_get_path('module', 'nexteuropa_ds_layouts');

  $layouts['ne_bootstrap_3_6_3_stacked'] = array(
    'label' => t('NE Bootstrap: 3-6-3 stacked'),
    'path' => $path . '/layouts/ne_bootstrap_3_6_3_stacked',
    'regions' => array(
      'left_header' => t('Left Header'),
      'right_header' => t('Right Header'),
      'top' => t('Top'),
      'left' => t('Left'),
      'central' => t('Middle'),
      'right' => t('Right'),
    ),
    'form' => TRUE,
    'image' => TRUE,
  );

  $layouts['ne_bootstrap_3_9_stacked'] = array(
    'label' => t('NE Bootstrap: 3-9 stacked'),
    'path' => $path . '/layouts/ne_bootstrap_3_9_stacked',
    'regions' => array(
      'left_header' => t('Left Header'),
      'right_header' => t('Right Header'),
      'top' => t('Top'),
      'left' => t('Left'),
      'central' => t('Middle'),
    ),
    'form' => TRUE,
    'image' => TRUE,
  );

  $layouts['ne_bootstrap_1col_stacked'] = array(
    'label' => t('NE Bootstrap: 1col stacked'),
    'path' => $path . '/layouts/ne_bootstrap_1col_stacked',
    'regions' => array(
      'left_header' => t('Left Header'),
      'right_header' => t('Right Header'),
      'top' => t('Top'),
      'central' => t('Main'),
    ),
    'form' => TRUE,
    'image' => TRUE,
  );

  $layouts['ne_2col'] = array(
    'label' => t('NE: 2col'),
    'path' => $path . '/layouts/ne_2col',
    'regions' => array(
      'main' => t('Main'),
      'second' => t('Second'),
    ),
    'form' => TRUE,
    'image' => TRUE,
  );

  $layouts['ne_1col'] = array(
    'label' => t('NE: 1col'),
    'path' => $path . '/layouts/ne_1col',
    'regions' => array(
      'main' => t('Main'),
    ),
    'form' => TRUE,
    'image' => TRUE,
  );

  return $layouts;
}

/**
 * Implements hook_field_formatter_info().
 */
function nexteuropa_ds_layouts_field_formatter_info() {
  return array(
    'nexteuropa_ds_layouts_formatter_link_button_default' => array(
      'label' => 'Link button default',
      'field types' => array('link_field'),
    ),
    'nexteuropa_ds_layouts_formatter_link_button_primary' => array(
      'label' => 'Link button primary',
      'field types' => array('link_field'),
    ),
    'nexteuropa_ds_layouts_formatter_link_button_secondary' => array(
      'label' => 'Link button secondary',
      'field types' => array('link_field'),
    ),
    'nexteuropa_ds_layouts_formatter_link_button_call_for_action' => array(
      'label' => 'Link button call for action',
      'field types' => array('link_field'),
    ),
    'nexteuropa_ds_layouts_formatter_link_button_block' => array(
      'label' => 'Link button block',
      'field types' => array('link_field'),
    ),
  );
}


/**
 * Helper function to select the right class.
 *
 * @param string $formatter
 *   Formatter name.
 *
 * @return string
 *   Class connected to formatter.
 */
function _nexteuropa_ds_layouts_field_formatter_view_classes($formatter) {
  switch ($formatter) {
    case 'nexteuropa_ds_layouts_formatter_link_button_default':
      return 'btn btn-default';

    case 'nexteuropa_ds_layouts_formatter_link_button_primary':
      return 'btn btn-primary';

    case 'nexteuropa_ds_layouts_formatter_link_button_secondary':
      return 'btn btn-secondary';

    case 'nexteuropa_ds_layouts_formatter_link_button_call_for_action':
      return 'btn btn-ctn';

    case 'nexteuropa_ds_layouts_formatter_link_button_block':
      return 'btn btn-default btn-block';

  }
  return '';
}

/**
 * Implements hook_field_formatter_view().
 */
function nexteuropa_ds_layouts_field_formatter_view($entity_type, $entity, $field, $instance, $langcode, $items, $display) {
  $elements = array();
  $formatter = $display['type'];

  foreach ($items as $delta => $item) {
    // Set attribute from formatter settings.
    $item['attributes']['class'] = _nexteuropa_ds_layouts_field_formatter_view_classes($formatter);

    // Call theme function of link module (theme_link_formatter_link_default).
    $elements[$delta] = array(
      '#theme' => 'link_formatter_link_default',
      '#element' => $item,
      '#field' => $instance,
      '#display' => $display,
    );
  }
  // Multiple field wrapper.
  if (($field['cardinality'] == -1) && ($formatter != 'nexteuropa_ds_layouts_formatter_link_button_block')) {
    $elements['#prefix'] = '<div class="btn-group">';
    $elements['#suffix'] = '</div>';
  }
  return $elements;
}
